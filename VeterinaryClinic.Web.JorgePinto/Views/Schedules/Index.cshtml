@{
    ViewBag.Title = "Index";
}

<h3>Schedules</h3>

<div id="calendar"></div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.0.1/fullcalendar.min.css" />

@section Scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.0.1/fullcalendar.min.js"></script>

    <script>
        $(document).ready(function () {
            var currentDate = new Date(); // Obtém a data atual

            // Formata a data atual no formato "YYYY-MM-DD"
            var defaultDate = currentDate.toISOString().slice(0, 10);

            var calendar = $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                defaultDate: defaultDate, // Define a data atual como a data padrão
                defaultView: 'agendamonth',
                slotDuration: '00:30:00',
                minTime: '09:00:00',
                maxTime: '17:30:00',
                weekends: false,
                editable: true,
                selectable: true,
                selectHelper: true,
                select: function (start, end) {
                    if (end.diff(start, 'minutes') === 30) {
                        var title = prompt('Enter an event:');
                        if (title) {
                            var eventData = {
                                title: title,
                                start: start,
                                end: end
                            };
                            calendar.fullCalendar('renderEvent', eventData, true);
                            calendar.fullCalendar('unselect');
                        }
                    } else {
                        alert('Please select a 30-minute slot.');
                    }
                },
                events: []
            });

            function refreshEvents() {
                calendar.fullCalendar('refetchEvents');
            }

            setInterval(refreshEvents, 30000);
        });

    </script>
}
